function results = phase2_mean_sample_test(robot_arm, config)

alpha   = config.alpha;
winFrac = config.winFrac;
minWin  = config.minWin;

N = numel(robot_arm);

results.N = N;
results.p = nan(N,1);
results.h = false(N,1);
results.nStart = zeros(N,1);
results.nEnd   = zeros(N,1);
results.meanStart = nan(N,1);
results.meanEnd   = nan(N,1);

for k = 1:N
    v = robot_arm(k).sampleset(:);
    T = numel(v);
    w = max(minWin, round(winFrac * T));
 
    if 2*w > T
        w = floor(T/2);
    end

    x = v(1:w);
    y = v((T-w+1):T);

    results.nStart(k) = numel(x);
    results.nEnd(k)   = numel(y);
    results.meanStart(k) = mean(x);
    results.meanEnd(k)   = mean(y);

    [h,p] = ttest2(x, y, 'Alpha', alpha, 'Vartype', 'unequal');

    results.p(k) = p;
    results.h(k) = logical(h);
end

idxBad = results.h;

for k = 1:N
    status = "OK";
    if idxBad(k)
        status = "OUT-OF-SPEC";
    end

    fprintf('Arm %3d: nS=%3d nE=%3d meanS=%.4g meanE=%.4g | p=%.4g h=%d --> %s\n', ...
        k, results.nStart(k), results.nEnd(k), ...
        results.meanStart(k), results.meanEnd(k), ...
        results.p(k), results.h(k), status);
end

badArms = find(idxBad);
if isempty(badArms)
    fprintf('\nAll arms OK at %.2f%% confidence.\n', (1-alpha)*100);
else
    fprintf('\nOut-of-spec arms: %s\n', mat2str(badArms));
end

end